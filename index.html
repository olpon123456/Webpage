<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Decoded ad URL</title>
  <style>
    html,body{height:100%;margin:0;font-family:system-ui,Arial;display:flex;align-items:center;justify-content:center;background:#111;color:#fff}
    .box{max-width:900px;padding:24px;text-align:center}
    .url{word-break:break-all;font-size:20px;background:#0b0b0b;padding:18px;border-radius:8px;border:1px solid #222}
    .msg{opacity:.85;margin-top:12px;font-size:14px;color:#ddd}
  </style>
</head>
<body>
  <div id="root" class="box">
    <div id="msg" class="msg">Fetching loader and decoding — please wait…</div>
  </div>

  <script>
  (async function(){
    const LOADER_URL = 'https://webpage-76ur.onrender.com/get-adcode'; // change if needed
    const root = document.getElementById('root');
    const msg = document.getElementById('msg');

    function showOnlyMessage(title, text, sub){
      document.title = title || document.title;
      root.innerHTML = '';
      const el = document.createElement('div');
      el.style.display = 'flex';
      el.style.flexDirection = 'column';
      el.style.alignItems = 'center';
      el.style.justifyContent = 'center';
      const urlEl = document.createElement('div');
      urlEl.className = 'url';
      urlEl.textContent = text;
      el.appendChild(urlEl);
      if(sub){
        const subEl = document.createElement('div');
        subEl.className = 'msg';
        subEl.textContent = sub;
        el.appendChild(subEl);
      }
      root.appendChild(el);
    }

    try{
      msg.textContent = 'Fetching loader...';
      const r = await fetch(LOADER_URL, {mode:'cors'});
      if(!r.ok) throw new Error('fetch failed: ' + r.status);
      const code = await r.text();

      // Try to find the s = [ "base64", "..." ] array (or any base64-like literals)
      // 1) Look for s = [ ... ] pattern first
      let found = [];
      const sArrayMatch = code.match(/s\s*=\s*\[([^\]]+)\]/m);
      if(sArrayMatch && sArrayMatch[1]){
        // extract quoted items inside the brackets
        const items = sArrayMatch[1].match(/(['"])(.*?)\1/g);
        if(items){
          for(const it of items){
            // remove surrounding quotes
            found.push(it.slice(1,-1));
          }
        }
      }

      // 2) fallback: find any atob('base64...') occurrences
      if(found.length === 0){
        const atobMatches = Array.from(code.matchAll(/atob\(\s*(['"])(.*?)\1\s*\)/g));
        for(const m of atobMatches) found.push(m[2]);
      }

      // 3) fallback: find any long base64-like literals in quotes
      if(found.length === 0){
        const literalMatches = Array.from(code.matchAll(/(['"])([A-Za-z0-9+/=]{40,})\1/g));
        for(const m of literalMatches) found.push(m[2]);
      }

      if(found.length === 0){
        showOnlyMessage('No base64 found', 'Could not locate base64 strings in loader.', 'The loader format might differ — paste it or inspect manually.');
        return;
      }

      // decode and pick first https URL
      let decodedUrl = null;
      for(const b64 of found){
        try{
          const dec = atob(b64);
          // if it's a url, use it
          if(/^https?:\/\//i.test(dec.trim())){
            decodedUrl = dec.trim();
            break;
          }
        }catch(e){
          // ignore invalid base64
        }
      }

      // If no https URL found, show first decoded string as fallback
      if(!decodedUrl){
        for(const b64 of found){
          try{
            const dec = atob(b64);
            if(dec && dec.trim().length>0){
              decodedUrl = dec.trim();
              break;
            }
          }catch(e){}
        }
      }

      if(decodedUrl){
        showOnlyMessage('Decoded ad URL', decodedUrl, 'Decoded locally (no loader executed)');
      } else {
        showOnlyMessage('Decoded — nothing looked like a URL', 'Found base64 strings but none decoded to an http(s) URL.', 'You can inspect the base64 list in console.');
        console.log('Base64 candidates found:', found);
        for(const b of found){
          try{ console.log('decoded:', atob(b)); }catch(e){ console.log('failed decode', e, b); }
        }
      }

    }catch(err){
      showOnlyMessage('Error', 'Failed to fetch or decode loader', String(err));
    }
  })();
  </script>
</body>
</html>